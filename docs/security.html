<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="luminus, clojure, framework, leiningen">
    <meta name="canonical" content="http://luminusweb.net">
    <title>Security | Luminus - a Clojure web framework</title>
    <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/color-brewer.min.css">
    <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
    <link href="/css/highlight.css" rel="stylesheet" type="text/css" />
    <link href="/css/codestyle.css" rel="stylesheet" type="text/css" />
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
    
  </head>
  <body>
    <header>
      <div class="wrapper">
        <div class="column-wrapper">
          <div class="row">
            <div id="logo">
              <h1>
                <a href="/">
                  <img src="/img/logo.png" alt="Luminus">
                  Luminus
                </a>
              </h1>
            </div>
            <nav>
              <ul>
                <li >
                  <a href="/">Home</a>
                </li>
                <li  class="selected">
                  <a href="/docs/guestbook">
                    <span class="show-on-mobile">Docs</span>
                    <span class="hide-on-mobile">Documentation</span>
                  </a>
                </li>
                <li >
                  <a href="/contribute">
                    <span class="hide-on-mobile">Get Involved</span>
                    <span class="show-on-mobile">Contrib</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
          
          
        </div>
      </div>
    </header>
    <div class="wrapper">
      
<div class="row">
  <div class="column column-75">
    <div class="column-wrapper">
      <h1>Security</h1>
      
      <h2>Contents</h2>
      <ol class="contents"><li><a href="#restricting_route_access">Restricting Route Access</a></li><li><a href="#password_hashing">Password Hashing</a></li><li><a href="#ldap_authentication">LDAP Authentication</a></li><li><a href="#cross_site_request_forgery_protection">Cross Site Request Forgery Protection</a></li></ol>
      
      <div id="content">
        <h2 id="restricting&#95;route&#95;access">Restricting Route Access</h2><p>Please refer to the <a href='/docs/routes.html#restricting_access'>Routing section</a> for the instructions on securing the routes.</p><h2 id="password&#95;hashing">Password Hashing</h2><p>Password hashing and comparison is handled by the <code>buddy.hashers</code> namespace provided by the <a href='https://github.com/funcool/buddy'>Buddy</a>.</p><p>It provides two functions, <code>encrypt</code> and <code>check</code>. The first will encrypt and salt the password, while the second compares the raw password to the encrypted string generated by the first. BCrypt is used as the default encryption algorithm.</p><pre><code class="clojure">&#40;ns myapp.auth
  &#40;:require
   ...
   &#91;buddy.hashers :as hashers&#93;&#41;&#41;

&#40;def raw &quot;secret&quot;&#41;
&#40;def encrypted &#40;hashers/derive raw&#41;&#41;
&#40;hashers/check raw encrypted&#41;
</code></pre><p>The <code>encrypt</code> function allows specifying additional parameters such as the algorithm and the number of iterations:</p><pre><code class="clojure">&#40;hashers/derive &quot;secretpassword&quot; {:alg :pbkdf2+sha256}&#41;
&#40;hashers/derive &quot;secretpassword&quot; {:alg :pbkdf2+sha256
                                   :salt &quot;123456&quot;}&#41;
&#40;hashers/derive &quot;secretpassword&quot; {:alg :pbkdf2+sha256
                                   :salt &quot;123456&quot;
                                   :iterations 200000}&#41;
</code></pre><p>The following algorithms with their associated options and defaults are seen below:</p><ul><li><code>:alg :bcrypt+sha512</code><ul><li><code>:iterations</code> 12</li><li><code>:salt</code> random</li></ul></li><li><code>:alg :pbkdf2+sha256</code><ul><li><code>:iterations</code> 100000</li><li><code>:salt</code> random</li></ul></li><li><code>:alg :pbkdf2+sha3&#95;256</code><ul><li><code>:iterations</code> 100000</li><li><code>:salt</code> random</li></ul></li><li><code>:alg :pbkdf2+sha1</code><ul><li><code>:iterations</code> 100000</li><li><code>:salt</code> random</li></ul></li><li><code>:alg :scrypt</code><ul><li><code>:salt</code> random</li><li><code>:cpucost</code> 65536</li><li><code>:memcost</code> 8</li><li><code>:parallelism</code> 1</li></ul></li><li><code>:alg :sha256</code><ul><li><code>:salt</code> random</li></ul></li><li><code>:alg :md5</code><ul><li><code>:salt</code> random</li></ul></li></ul><p>For information on restricting access to specific routes, please refer to the <a href='/docs/routes.html#marking_routes_as_restricted'>routing section</a>.</p><p>For an alternative security solution you may wish to check out the <a href='https://github.com/cemerick/friend'>Friend</a> library.</p><h2 id="ldap&#95;authentication">LDAP Authentication</h2><p>The following example demonstrates how to authenticate with the <code>sAMAccountName</code> using the <a href='https://github.com/pauldorman/clj-ldap'>clj-ldap</a> library.</p><p>First, we'll add the following dependency to your <code>project.clj</code>.</p><pre><code class="clojure">&#91;org.clojars.pntblnk/clj-ldap &quot;0.0.16&quot;&#93;
</code></pre><p>Next, we'll need to require the LDAP client in the authentication namespace and <code>defstate</code> to hold the connection pool:</p><pre><code class="clojure">&#40;ns ldap-auth
  &#40;:require
    &#91;mount.core :refer &#91;defstate&#93;&#93;
    &#91;clj-ldap.client :as client&#93;&#41;&#41;
</code></pre><p>We'll define our LDAP host as follows, note that the <code>host</code> key points to a vector of LDAP servers.</p><pre><code class="clojure">&#40;def host
  {:host
   {:address         &quot;my-ldap-server.ca&quot;
    :port            389
    :connect-timeout &#40;&#42; 1000 5&#41;
    :timeout         &#40;&#42; 1000 30&#41;}}&#41;
</code></pre><p>We'll can now declare a connection pool for LDAP:</p><pre><code class="clojure">&#40;defstate ldap-pool :start &#40;client/connect host&#41;&#41;
</code></pre><p>Finally, we'll write a function to authenticate the user using the above declared pool.</p><pre><code class="clojure">&#40;defn authenticate &#91;username password &amp; &#91;attributes&#93;&#93;
  &#40;let &#91;conn           &#40;client/get-connection ldap-pool&#41;
        qualified-name &#40;str username &quot;@&quot; &#40;-&gt; host :host :address&#41;&#41;&#93;
    &#40;try
      &#40;if &#40;client/bind? conn qualified-name password&#41;
        &#40;first &#40;client/search conn
                              &quot;ou=people,dc=example,dc=com&quot;
                              {:filter     &#40;str &quot;sAMAccountName=&quot; username&#41;
                               :attributes &#40;or attributes &#91;&#93;&#41;}&#41;&#41;&#41;
      &#40;finally &#40;client/release-connection ldap-pool conn&#41;&#41;&#41;&#41;&#41;
</code></pre><p>The <code>attributes</code> vector can be used to filter the keys that are returned, an empty vector will return all the keys associated with the account.</p><h3 id="cross&#95;site&#95;request&#95;forgery&#95;protection">Cross Site Request Forgery Protection</h3><p>CSRF attack involves a third party performing an action on your site using the credentials of a logged-in user. This can commonly occur when your site contains a malicious link, a form button, or some JavaScript.</p><p><a href='https://github.com/ring-clojure/ring-anti-forgery'>Ring-Anti-Forgery</a> is used to protect against CSRF attacks. Anti-forgery protection is enabled by default.</p><p>Once the CSRF middleware is enabled a randomly-generated string will be assigned to the <em>anti-forgery-token</em> var. Any POST requests coming to the server will have to contain a parameter called <code>&#95;&#95;anti-forgery-token</code> with this token.</p><p>The <code>&lt;app&gt;.layout</code> namespace of your application creates a <code>csrf-field</code> tag that can be used to provide the token on the page:</p><pre><code class="clojure">&#40;parser/add-tag! :csrf-field &#40;fn &#91;&#95; &#95;&#93; &#40;anti-forgery-field&#41;&#41;&#41;
</code></pre><p>We can use it in our templates as follows:</p><pre><code class="xml">&lt;form name=&quot;input&quot; action=&quot;/login&quot; method=&quot;POST&quot;&gt;
  {% csrf-field %}
  Username: &lt;input type=&quot;text&quot; name=&quot;user&quot;&gt;
  Password: &lt;input type=&quot;password&quot; name=&quot;pass&quot;&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
&lt;/form&gt;
</code></pre><p>Any requests that aren't <code>GET</code> or <code>HEAD</code> and do not contain the token will be rejected by the middleware. The server will respond with a 403 error saying "Invalid anti-forgery token".</p><p>The anti-forgery middleware is wrapped around the <code>home-routes</code> using the <code>:middleware</code> declaration in the router:</p><pre><code class="clojure">&#40;defn home-routes &#91;&#93;
  &#91;&quot;&quot;
   {:middleware &#91;middleware/wrap-csrf
                 middleware/wrap-formats&#93;}
   &#91;&quot;/&quot; {:get home-page
         :post save-message!}&#93;
   &#91;&quot;/about&quot; {:get about-page}&#93;&#93;&#41;
</code></pre><p>Please see <a href='/docs/services.html#csrf'>here</a> on details how to enable CSRF for select routes in your application.</p>
      </div>
    </div>
  </div>
  <div class="column column-25">
    <div class="column-wrapper">
      <div id="build-tool-div">
        <p>Build Tool:
          <select name="build-tool" id="build-tool" >
            <option value="lein" >lein</option>
            <option value="boot" >boot</option>
          </select>
        </p>
      </div>
      <h2>Topics</h2>
      <ul>
        
        <li >
          <a href="/docs/guestbook.html">
            Your First Application
          </a>
        </li>
        
        <li >
          <a href="/docs/repl.html">
            REPL Driven Development
          </a>
        </li>
        
        <li >
          <a href="/docs/profiles.html">
            Application Profiles
          </a>
        </li>
        
        <li >
          <a href="/docs/html_templating.html">
            HTML Templating
          </a>
        </li>
        
        <li >
          <a href="/docs/assets.html">
            Static Assets
          </a>
        </li>
        
        <li >
          <a href="/docs/clojurescript.html">
            ClojureScript
          </a>
        </li>
        
        <li >
          <a href="/docs/routes.html">
            Routing
          </a>
        </li>
        
        <li >
          <a href="/docs/services.html">
            RESTful Services
          </a>
        </li>
        
        <li >
          <a href="/docs/requests.html">
            Request types
          </a>
        </li>
        
        <li >
          <a href="/docs/responses.html">
            Response types
          </a>
        </li>
        
        <li >
          <a href="/docs/websockets.html">
            Websockets
          </a>
        </li>
        
        <li >
          <a href="/docs/middleware.html">
            Middleware
          </a>
        </li>
        
        <li >
          <a href="/docs/sessions_cookies.html">
            Sessions and Cookies
          </a>
        </li>
        
        <li >
          <a href="/docs/input_validation.html">
            Input Validation
          </a>
        </li>
        
        <li class="selected" >
          <a href="/docs/security.html">
            Security
          </a>
        </li>
        
        <li >
          <a href="/docs/components.html">
            Component Lifecycle
          </a>
        </li>
        
        <li >
          <a href="/docs/database.html">
            Database Access
          </a>
        </li>
        
        <li >
          <a href="/docs/migrations.html">
            Database Migrations
          </a>
        </li>
        
        <li >
          <a href="/docs/logging.html">
            Logging
          </a>
        </li>
        
        <li >
          <a href="/docs/i18n.html">
            Internationalization
          </a>
        </li>
        
        <li >
          <a href="/docs/testing.html">
            Testing
          </a>
        </li>
        
        <li >
          <a href="/docs/servers.html">
            Server Tuning
          </a>
        </li>
        
        <li >
          <a href="/docs/environment.html">
            Environment Variables
          </a>
        </li>
        
        <li >
          <a href="/docs/deployment.html">
            Deployment
          </a>
        </li>
        
        <li >
          <a href="/docs/useful_libraries.html">
            Useful Libraries
          </a>
        </li>
        
        <li >
          <a href="/docs/apps.html">
            Sample Applications
          </a>
        </li>
        
        <li >
          <a href="/docs/upgrading.html">
            Upgrading
          </a>
        </li>
        
        <li >
          <a href="/docs/learning_clojure.html">
            Clojure Resources
          </a>
        </li>
        
      </ul>
      <h2>Books</h2>
      <ul>
        <li>
          <a href="https://pragprog.com/titles/dswdcloj3/">
            <img src="/img/wdwc2.png" class="bookimage">
          </a>
        </li>
        <li><a href=""></a></li>
      </ul>
    </div>
  </div>
</div>

    </div>
    <footer>
      <article class="wrapper">
        <div class="column-wrapper">
          <p>
            Luminus framework is released under the <a href="http://opensource.org/licenses/MIT">MIT License</a>
            -
            Copyright ©
            <span id="cpyear"></span>
          </p>
        </div>
      </article>
    </footer>

    <script src="/js/highlight.pack.js" type="text/javascript"></script>
    <script src="/js/site.js" type="text/javascript"></script>
    
<script src="/js/docs.js" type="text/javascript"></script>

  </body>
</html>
